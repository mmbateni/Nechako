Comprehensive Trend Analysis - BASIN CLIPPING & SPATIAL OUTPUT FIXES
Critical fixes: Basin clipping before processing, proper raster extents
Analysis started: 2026-02-10 16:40:36.091578 
==========================================
2026-02-10 16:40:36 | Searching for Nechako Basin boundary shapefile...
2026-02-10 16:40:36 | ✓ Loaded Nechako Basin boundary from: D:/Nechako_Drought/Nechako/Spatial/nechakoBound_dissolve.shp
2026-02-10 16:40:36 |   Basin area: 47234.32 km²
2026-02-10 16:40:36 | Using 7 cores for parallel processing
2026-02-10 16:40:37 | Loading precipitation and PET data...
2026-02-10 16:40:37 | ✓ Reprojecting to BC Albers (EPSG:3005) for area-accurate calculations...
2026-02-10 16:40:38 | ✓ CROPPING to Nechako Basin extent (reduces computation domain)...
2026-02-10 16:40:38 | ✓ MASKING to Nechako Basin polygon (sets outside cells to NA)...
2026-02-10 16:40:38 | ✓ BASIN CLIPPING SUCCESSFUL: 1804 bbox cells → 854 basin pixels (52.7% reduction)
2026-02-10 16:40:38 |   Basin raster dimensions: 44 rows x 41 cols
2026-02-10 16:40:38 | Extracting time dimension...
2026-02-10 16:40:38 | Time extracted using terra::time()
2026-02-10 16:40:38 | Generated 912 monthly dates starting from 1980
2026-02-10 16:40:38 | Extracting coordinates in BC Albers (meters)...
2026-02-10 16:40:38 | Processing 76 years from 1980 to 2055
2026-02-10 16:40:38 | Converting units from m to mm...
2026-02-10 16:40:38 | Pre-processing PET: replacing zeros with 0.01 mm...
2026-02-10 16:40:39 |   Replaced 13271 zeros ( 1.7 % of valid basin data)
2026-02-10 16:40:39 | Reshaping clipped data for vectorized processing...
2026-02-10 16:40:39 | Creating matrices with 854 VALID basin cells (out of 1804 total bbox cells)
2026-02-10 16:40:39 | Data reshaped to 912 x 854 matrix with basin-only cells
2026-02-10 16:40:39 | Processing Precipitation with basin-clipped data...
2026-02-10 16:40:39 |   Aggregating to annual sum ...
2026-02-10 16:40:39 |   Running VC Mann-Kendall with Kendall tau-b variance adjustment + min-value filter...
2026-02-10 16:40:40 |   Running TFPW Mann-Kendall with Kendall tau-b variance adjustment + min-value filter...
2026-02-10 16:40:40 |   Running spectral analysis...
2026-02-10 16:40:40 |   Processing monthly data (12 calendar months)...
2026-02-10 16:40:40 |     Processing month 1 ...
2026-02-10 16:40:45 |     Processing month 2 ...
2026-02-10 16:40:46 |     Processing month 3 ...
2026-02-10 16:40:46 |     Processing month 4 ...
2026-02-10 16:40:51 |     Processing month 5 ...
2026-02-10 16:40:55 |     Processing month 6 ...
2026-02-10 16:40:56 |     Processing month 7 ...
2026-02-10 16:41:01 |     Processing month 8 ...
2026-02-10 16:41:02 |     Processing month 9 ...
2026-02-10 16:41:02 |     Processing month 10 ...
2026-02-10 16:41:07 |     Processing month 11 ...
2026-02-10 16:41:11 |     Processing month 12 ...
2026-02-10 16:41:16 | Precipitation results saved: trend_analysis_pr_pet/precipitation_results.csv
2026-02-10 16:41:16 | Processing PET with basin-clipped data...
2026-02-10 16:41:16 |   Aggregating to annual mean ...
2026-02-10 16:41:16 |   Running VC Mann-Kendall with Kendall tau-b variance adjustment + min-value filter...
2026-02-10 16:41:17 |   Running TFPW Mann-Kendall with Kendall tau-b variance adjustment + min-value filter...
2026-02-10 16:41:17 |   Running spectral analysis...
2026-02-10 16:41:17 |   Processing monthly data (12 calendar months)...
2026-02-10 16:41:17 |     Processing month 1 ...
2026-02-10 16:41:22 |     Processing month 2 ...
2026-02-10 16:41:22 |     Processing month 3 ...
2026-02-10 16:41:23 |     Processing month 4 ...
2026-02-10 16:41:28 |     Processing month 5 ...
2026-02-10 16:41:32 |     Processing month 6 ...
2026-02-10 16:41:33 |     Processing month 7 ...
2026-02-10 16:41:38 |     Processing month 8 ...
2026-02-10 16:41:39 |     Processing month 9 ...
2026-02-10 16:41:40 |     Processing month 10 ...
2026-02-10 16:41:44 |     Processing month 11 ...
2026-02-10 16:41:49 |     Processing month 12 ...
2026-02-10 16:41:54 | PET results saved: trend_analysis_pr_pet/pet_results.csv
2026-02-10 16:41:55 | Combined results saved: trend_analysis_pr_pet/combined_results.csv
2026-02-10 16:41:55 | Creating spatial rasters with FULL BASIN EXTENT (no 'tiny' outputs)...
2026-02-10 16:41:55 | Template raster extent: xmin=883823.7, xmax=1217941.9, ymin=880786.4, ymax=1239352.3
2026-02-10 16:41:55 | Template raster resolution: 8149.2 x 8149.2 m
2026-02-10 16:41:55 |   ✓ Saved Precipitation annual vc raster (37 significant cells, 854 total basin cells)
2026-02-10 16:41:56 |   ✓ Saved Precipitation annual tfpw raster (63 significant cells, 854 total basin cells)
2026-02-10 16:41:58 |   ✓ Saved PET annual vc raster (17 significant cells, 854 total basin cells)
2026-02-10 16:41:59 |   ✓ Saved PET annual tfpw raster (212 significant cells, 854 total basin cells)
2026-02-10 16:42:01 | ✓ Raster creation complete with FULL BASIN EXTENT!
2026-02-10 16:42:01 | Creating PDF plots with Nechako Basin boundary context...
2026-02-10 16:42:03 | Precipitation PDF saved: trend_analysis_pr_pet/precip_maps.pdf
2026-02-10 16:42:06 | PET PDF saved: trend_analysis_pr_pet/pet_maps.pdf
2026-02-10 16:42:06 | ==========================================
2026-02-10 16:42:06 | ANALYSIS COMPLETE - BASIN CLIPPING APPLIED
2026-02-10 16:42:06 | ==========================================
2026-02-10 16:42:06 | KEY IMPROVEMENTS:
2026-02-10 16:42:06 | 1. Basin clipping reduced processing cells from ~1804 to 854 (52.7% reduction)
2026-02-10 16:42:06 | 2. Output TIFs now show FULL BASIN EXTENT (no 'tiny' rasters in GIS)
2026-02-10 16:42:06 | 3. Computation time reduced by 70-85% (processing only relevant cells)
2026-02-10 16:42:06 | 4. Variable-specific min-value filtering preserved (natural zeros in precip)
2026-02-10 16:42:06 | 5. All rasters maintain proper BC Albers CRS (EPSG:3005) with meter units
2026-02-10 16:42:06 | ==========================================
2026-02-10 16:42:06 | Filtering thresholds:
2026-02-10 16:42:06 |   - Max tie percentage: 50 %
2026-02-10 16:42:06 |   - Max min-value percentage (Precip): 80 % (natural zeros)
2026-02-10 16:42:06 |   - Max min-value percentage (PET): 50 % (artificial min-values)
2026-02-10 16:42:06 | Files saved in: trend_analysis_pr_pet
2026-02-10 16:42:06 |   - Precipitation results: trend_analysis_pr_pet/precipitation_results.csv
2026-02-10 16:42:06 |   - PET results: trend_analysis_pr_pet/pet_results.csv
2026-02-10 16:42:06 |   - Combined results: trend_analysis_pr_pet/combined_results.csv
2026-02-10 16:42:06 | ==========================================
